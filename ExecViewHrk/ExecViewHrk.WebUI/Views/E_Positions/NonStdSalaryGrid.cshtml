@model ExecViewHrk.Models.E_PositioVm
<script src="http://localhost/ExecViewDrew/Scripts/application/Common.js"></script>
@{
    ViewBag.Title = "Employee Positions";
    Layout = null;
    string alert = "";
    if (ViewBag.AlertMessage != null)
    {
        alert = (string)ViewBag.AlertMessage;
    }
}
<style>
    .modal-backdrop {
        z-index: 9998;
    }
</style>
<script>
    function test(options)
    {
        return {
            e_PositionId: '@ViewBag.ePositionId'
        }
    }
</script>
<div class="card-header p-l-0">
    <h5 class="card-header-text">Salary History</h5>
    @if (ViewBag.EmployeeTypeDescription != null)
    {
        <h5 class="card-header-text hdnempt" style="padding-left: 90px; display:none"> Employee Type : @ViewBag.EmployeeTypeDescription</h5>
    }
    else
    {
        <h5 class="card-header-text hdnempt" style="padding-left: 90px; display:none"> Employee Type : None</h5>
    }
</div>
<div class="row">
    <div class="card-block">
        <div class="col-lg-12 col-md-12 p-0">
            <div class="row">
                <div class="col-lg-12 col-md-12">
                    <div class="theme-grid">
                        @(Html.Kendo().Grid<ExecViewHrk.Models.E_PositioVm>()
                                .Name("gridEmployeeSalPosition1")
                                .Resizable(resize => resize.Columns(true))
                                .Filterable()

                                .Columns(columns =>
                                {
                                    //columns.Command(command =>
                                    //{
                                    //    command.Custom("gridEditCommand").Text("<i class='fa fa-pencil txt-primary f-18'></i>").Click("gridEmployeeSalPositionEdit");
                                    //}).Width(40);
                                    columns.Bound(c => c.E_PositionId).Visible(false);
                                    columns.Bound(c => c.RateTypeDescription).Width(120);//.ClientTemplate("#if( RateTypeId == 4){#<span>H</span>#}else if(RateTypeId == 5){#<span>S</span>#}#").Title("Rate Type");
                                    columns.Bound(c => c.PayRate).Width(80).Title("Rate").Format("{0:c2}");
                                    columns.Bound(c => c.HoursPerPayPeriod).Width(150).Title("Hours per Pay Period");
                                    columns.Bound(c => c.AnnualSalary).Width(100).Title("Annual Salary").Format("{0:c2}");
                                    columns.Bound(c => c.EffectiveDate).Width(100).Title("Effective Date").ClientTemplate("#= EffectiveDate == null ? '' : kendo.toString(EffectiveDate, \"MM/dd/yyyy\") #");
                                    columns.Bound(c => c.EndDate).Width(100).Title("End Date").ClientTemplate("#= EndDate == null ? '' : kendo.toString(EndDate, \"MM/dd/yyyy\") #");
                                })
                                                .Sortable().Scrollable()
                                                .Selectable()
                                                .Pageable(pageable => pageable.Refresh(false).PageSizes(true))
                                                .Events(e => e.DataBound("gridDataBound"))
                                                .DataSource(dataSource => dataSource.Ajax()
                                                                .Read(read => read.Action("NonStdSalaryGrid_Read", "E_Positions").Data("test"))//, new { e_PositionId = ViewBag.ePositionId }))

                                                                .Model(model =>
                                                                {
                                                                    model.Id(p => p.E_PositionId);
                                                                    model.Field(p => p.E_PositionId);
                                                                    model.Field(p => p.RateTypeId);
                                                                    model.Field(p => p.PayRate);
                                                                    model.Field(p => p.HoursPerPayPeriod);
                                                                    model.Field(p => p.AnnualSalary);
                                                                    model.Field(p => p.EffectiveDate);
                                                                    model.Field(p => p.EndDate);
                                                                }
                                                            )
                                                            .PageSize(10)
                                                    .Batch(false)
                                                    .Events(events =>
                                                    {
                                                        events.Error("refreshGrid");
                                                        events.RequestEnd("gridRequestEnd");
                                                    })
                                                )
                        )
                    </div>
                </div>
            </div>
            <div class="card-header p-l-0">
                <h5 class="card-header-text">Salary Payments</h5>
            </div>
            <div class="row">
                <div class="card-block">
                    <div class="col-lg-12 col-md-12 p-0">
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="theme-grid">
                                    @(Html.Kendo().Grid<ExecViewHrk.Models.NonStandardSalaryPayment>()
                                            .Name("gridnonstandardsalaryPayments")
                                            .Resizable(resize => resize.Columns(true))
                                            .Filterable()

                                            .Columns(columns =>
                                            {
                                                columns.Bound(c => c.SalaryPaymentId).Visible(false);
                                                columns.Bound(c => c.SalaryPaymentCode).Width(80).Title("").ClientFooterTemplate("Current DPA Balance");
                                                columns.Bound(c => c.SALMemoCode).Width(80).Title("Memo Code");
                                                columns.Bound(c => c.SALMemoAmount).Width(100).Title("Memo Code Amt").ClientTemplate("#= SALMemoAmount !== null ? kendo.toString(SALMemoAmount,'n2') : ''#");
                                                columns.Bound(c => c.DPAMemoCode).Width(80).Title("Memo Code");
                                                if (ViewBag.TerminationDate != null)
                                                {
                                                    columns.Bound(c => c.DPAMemoAmount).Width(100).Title("Memo Code Amt").ClientTemplate("#= DPAMemoAmount !== null ? kendo.toString(DPAMemoAmount,'n2') : ''#").ClientFooterTemplate("#= kendo.format('{0:n2}', sum * -1)#");
                                                }
                                                else
                                                {
                                                    columns.Bound(c => c.DPAMemoAmount).Width(100).Title("Memo Code Amt").ClientTemplate("#= DPAMemoAmount !== null ? kendo.toString(DPAMemoAmount,'n2') : ''#").ClientFooterTemplate("#= kendo.format('{0:n2}', sum)#");
                                                }
                                                columns.Bound(c => c.CancelPayDescription).Width(100).Title("Cancel Pay");
                                            })
                                                            .Sortable()
                                                            .Scrollable(scrollable => scrollable.Height(71))
                                                            .Selectable()
                                                            //.Pageable(pageable => pageable.Refresh(false).PageSizes(true))
                                                            .Events(e => e.DataBound("gridDataBound"))
                                                            .DataSource(dataSource => dataSource.Ajax()
                                                                            //.Read(read => read.Action("NonStandardSalaryPayment_Read", "E_Positions").Data("test"))
                                                                            //.Read(read => read.Action("NonStandardSalaryTotalPayment_Read", "E_Positions").Data("test"))
                                                                            .Read(read => read.Action("NonStandardSalaryTotalExportedPayment_Read", "E_Positions").Data("test"))
                                                                            .Model(model =>
                                                                            {
                                                                                model.Id(p => p.SalaryPaymentId);
                                                                                model.Field(p => p.SalaryPaymentCode);
                                                                                model.Field(p => p.SALMemoCode);
                                                                                model.Field(p => p.SALMemoAmount);
                                                                                model.Field(p => p.DPAMemoCode);
                                                                                model.Field(p => p.DPAMemoAmount);
                                                                                model.Field(p => p.CancelPayDescription);
                                                                            }
                                                                        )
                                                                //.PageSize(10)
                                                                .Batch(false)
                                                                .Aggregates(aggregates =>
                                                                {
                                                                    aggregates.Add(p => p.SALMemoAmount).Sum();                                                                    
                                                                    aggregates.Add(p => p.DPAMemoAmount).Sum();
                                                                })
                                                                .Events(events =>
                                                                {
                                                                    events.Error("refreshGrid");
                                                                    events.RequestEnd("gridRequestEnd");
                                                                })
                                                            )
                                    )
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*<div class="modal fade" id="SalaryAddModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
        @Html.Partial("AddPositionSalaryHistory", new ExecViewHrk.Models.E_PositionSalaryHistorVm())
    </div>*@
@*<div class="modal fade" id="SalaryEditModal1" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    @Html.Partial("EditPositionSalaryHistory", new ExecViewHrk.Models.E_PositionSalaryHistorVm())
</div>*@