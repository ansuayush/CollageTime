
@{
    ViewBag.Title = "Employer List";
    Layout = "~/Views/Shared/_HrkAdminLayout.cshtml";
}
<div class="container-fluid">
    <div class="row p-t-15">
        <div class="col-lg-12 col-md-12">
            <div class="main-header col-sm-12 p-0 m-b-0">
                <div class="col-md-9 m-b-15 p-0">
                    <h4>Employer List<span class="pull-right icon-edit-block m-l-30"><i class="fa fa-expand f-24" onclick="javascript:toggleFullScreen()"></i></span></h4>
                </div>
            </div>
            <div class="col-lg-12 col-md-12 p-0">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="card">
                            <div class="card-block">
                                <div class="table-primary table-striped">
                                    <div class="theme-grid">
                                      @(Html.Kendo().Grid<ExecViewHrk.EfAdmin.Employer>()
        .Name("grid")
        .Resizable(resize => resize.Columns(true))
        .Filterable()
        .Editable(editable => editable.Mode(GridEditMode.InLine))

        .Columns(columns =>
        {
            columns.Command(command => { command.Custom("gridEditCommand").Text("<i class='fa fa-pencil txt-primary f-18'></i>").Click("gridEmployerListEdit");
                                         command.Custom("gridDeleteCommand").Text("<i class='fa fa-trash-o m-0 txt-danger f-18'></i>").Click("gridDelete"); }).Width(70);
            columns.Bound(c => c.EmployerId).Width(130);
            columns.Bound(c => c.EmployerName).Width(400);
            columns.Bound(c => c.DatabaseName);
            columns.Bound(c => c.IsClient).ClientTemplate("#= IsClient ? 'yes' : 'no' #"); ;

        })
        .HtmlAttributes(new { style = "height: 480px;" })

        .Scrollable()
        .Sortable()
        .Selectable()

        .Pageable(pageable => pageable
            .Refresh(false)
            .PageSizes(true)
            .ButtonCount(5))
        .DataSource(dataSource => dataSource
            .Ajax()
                    .Read(read => read.Action("EmployerList_Read", "HrkAdmin"))
                    .Create(create => create.Action("EmployerList_Create", "HrkAdmin"))
                    .Update(update => update.Action("EmployerList_Update", "HrkAdmin"))
                    .Destroy(destroy => destroy.Action("EmployerList_Destroy", "HrkAdmin"))
            .Model(model =>
            {
                model.Id(p => p.EmployerId);
                model.Field(p => p.EmployerId).Editable(false);
                model.Field(p => p.EmployerName);
                model.Field(p => p.DatabaseName);
                model.Field(p => p.IsClient);

            }
                  )
            .Batch(false)
            .Events(events => events.Error("error_handler"))
        )
                                    ) 
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(".k-grid-add").click(function () {
        setTimeout(function () {
            $('a[class*="k-grid-update"]').html('<span class="k-icon k-update"></span>Create');
        }, 1)
    });
    function error_handler(e) {
        if (e.errors) {
            var message = "Errors:\n";
            $.each(e.errors, function (key, value) {
                if ('errors' in value) {
                    $.each(value.errors, function () {
                        message += this + "\n";
                    });
                }
            });
            alert(message);

            $('#grid').data('kendoGrid').dataSource.read();
            $('#grid').data('kendoGrid').refresh();
        }
    }
    function gridEmployerListEdit(e) {
        e.preventDefault();
        var grid = this;
        var row = $(e.currentTarget).closest("tr");
        var data = grid.dataItem(row);
        openEmployerListDetailEditpopup(data.EmployerId);
    }
    function openEmployerListDetailEditpopup(_EmployerId) {
        var formURL = $("#ApplicationUrl").val() + '/HrkAdmin/EditEmployer?employerId=' + _EmployerId;
        $("#EditDetailDiv .md-content").html("");
        $("#EditDetailDiv .md-content").load(formURL);
        $('#EditDetailDiv').toggle('slide', { direction: 'right' }, 500);
        $('#EditDetailDiv').addClass('md-show');
    }
</script>
