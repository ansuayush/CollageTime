@using System.Web.Routing;
@{
    ViewBag.Title = "UsersListMaintenance";
    Layout = "~/Views/Shared/_HrkAdminLayout.cshtml";
}
@model ExecViewHrk.WebUI.Models.UserViewModel
@{
    string alert = "";

    if (ViewBag.AlertMessage != null)
    {
        alert = (string)ViewBag.AlertMessage;
    }
}
<div class="container-fluid">
    <div class="row p-t-15">
        <div class="col-lg-12 col-md-12">
            <div class="col-lg-12 col-md-12 p-0">
                <div class="card-block p-10 m-b-10 b-b-muted b-t-muted">
                    <div class="main-header col-sm-12 p-0 m-b-0">
                        <div class="col-md-9 m-b-15 p-0">
                            <h4>USERS<span class="pull-right icon-edit-block m-l-30"><i class="fa fa-expand f-24" onclick="javascript:toggleFullScreen()"></i></span></h4>
                        </div>
                        </div>
                        <div class="col-md-9 p-0">
                            <button type="button" class="btn btn-primary waves-effect waves-light b-radius-2 text-tranform-normal myButton" onclick="">
                                </i><span class="m-l-10">Auto Generate All Employees</span>
                            </button>
                            <button type="button" class="btn btn-primary waves-effect waves-light b-radius-2 text-tranform-normal myButton" onclick="">
                                </i><span class="m-l-10">Delete all User Names</span>
                            </button>
                            <button type="button" class="btn btn-primary waves-effect waves-light b-radius-2 text-tranform-normal myButton" onclick="">
                                </i><span class="m-l-10">Email Employees</span>
                            </button>

                            @Html.CheckBox("templateId", new { value = "", @checked = "" })
                            @Html.Label("Show Active Employees only", new { style = "font-weight:bold" })
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12 col-md-12">
                            @Html.ValidationSummary(true)
                            <div class="theme-grid">

                                @(Html.Kendo().Grid<ExecViewHrk.WebUI.Models.UserViewModel>()
                                .Name("grid")
                                .Resizable(resize => resize.Columns(true))
                                .Filterable()
                                .Columns(columns =>
                                {
                                    columns.Command(command =>
                                    {
                                        command.Custom("gridEditCommand").Text("<i class='fa fa-pencil txt-primary f-18'></i>").Click("gridUsersListMatrixEdit");
                                        command.Custom("gridDeleteCommand").Text("<i class='fa fa-trash-o m-0 txt-danger f-18'></i>").Click("gridUserDelete");


                                    }).Width(70);



                                    columns.Bound(c => c.LastName).Title("Last Name");
                                    columns.Bound(c => c.FirstName).Title("First Name");
                                    columns.Bound(c => c.UserName).Title("User Name");
                                    //columns.Bound(c => c.EmployerName).Title("Employer");
                                    //columns.Bound(c => c.ResetPassword).Title("Reset Password").
                                    columns.Command(command =>
                                    {
                                        command.Custom("gridResetCommand").Text("<i class='fa fa-refresh'></i>").Click("gridUsersListReset");
                                    }).Width(50).Title("Reset Password");
                                })
                                .Sortable()
                                .Selectable()
                                .Pageable(pageable => pageable.Refresh(true).PageSizes(true))
                                .Events(e => e.DataBound("gridDataBound"))
                                .DataSource(dataSource => dataSource.Ajax()
                                                .Read(read => read.Action("UsersList_Read", "HrkAdmin"))

                                                .Model(model =>
                                                {

                                                    model.Id(p => p.UserId);
                                                    model.Id(p => p.LastName);
                                                    model.Field(p => p.FirstName);
                                                    model.Field(p => p.UserName);
                                                    model.Field(p => p.Password);
                                                   // model.Field(p => p.EmployerName);

                                                }
                                            )
                                            .PageSize(10)
                                    .Batch(false)
                                    .Events(events =>
                                    {
                                        events.Error("refreshGrid");
                                        events.RequestEnd("gridRequestEnd");
                                    })
                                )
                                )
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    function gridUsersListMatrixEdit(e) {
        e.preventDefault();
        var grid = this;
        var row = $(e.currentTarget).closest("tr");
        var data = grid.dataItem(row);
        openPersonEmployeePopup(data.Id);
    }

    function openPersonEmployeePopup(_userId) {
        loading(true);
        var formURL = $("#ApplicationUrl").val() + '/HrkAdmin/Edit?UserId=' + _userId;
        $("#EditDetailDiv .md-content").html("");
        $("#EditDetailDiv .md-content").load(formURL);
        $('#EditDetailDiv').toggle('slide', { direction: 'right' }, 500);
        $('#EditDetailDiv').addClass('md-show');
    }

    function gridUsersListReset(e) {       
        e.preventDefault();
        var grid = this;
        var row = $(e.currentTarget).closest("tr");
        var data = grid.dataItem(row);       
        $.get($("#appBaseUrl").val() + "HrkAdmin/UpdatingAspNetUserNamePassword?UserId=" + data.Id, function (data, status) {           
            toastr.success('Password Reset successfully!');
        });        
    }
    function gridUserDelete(e) {
        e.preventDefault();
        var grid = this;
        var row = $(e.currentTarget).closest("tr");
        var data = grid.dataItem(row);
        var UserId = data.Id;
        var postData = { e_PositionIdDdl: data.Id };
        var formURL = $("#ApplicationUrl").val() + '/HrkAdmin/UserDeleteajax?UserId=' + UserId;
        confirmDialog("", function () {
            $.post(formURL, postData, function (data, status) {
                if (data.succeed == false) {
                    toastr.error(data.Message);
                } else {
                    toastr.success('Record deleted successfully.');
                    resetGrid("grid");
                }
            });
        });
    }
</script>