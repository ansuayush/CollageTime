@model ExecViewHrk.Models.HoursCodeVm
@{
    ViewBag.Title = "Hours COdes";
    Layout = null;
}
<div class="card p-15">
    <div class="card-header">
        <h5 class="card-header-text">Hours Code</h5>
    </div>
    <div class="card-block">
        <div class="row">
            @using (Html.BeginForm(" HoursEditMatrix ", "HoursCodesController", FormMethod.Post, new { role = "form", id = "frmHoursCode" }))
            {
                @Html.HiddenFor(model => model.HoursCodeId, new { id = "hiddenHourId" })
                @Html.ValidationSummary(true)
                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-group ">
                            <label><span style="color:red">*</span>Company Code</label>
                            @Html.DropDownListFor(model => model.CompanyCodeId,
                                     new SelectList((System.Collections.IEnumerable)ViewData["companyCodesList"], "CompanyCodeId", "CompanyCodeDescription"), "--Select One--", new { @class = "form-control", data_required = "Y" })
                            @Html.ValidationMessageFor(x => x.CompanyCodeId)
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group ">
                            <label><span style="color:red">*</span> Hours Code </label>
                            @Html.TextBoxFor(x => x.HoursCodeCode, new { @class = "form-control", data_required = "Y" })
                            @Html.ValidationMessageFor(x => x.HoursCodeCode)
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group ">
                            <label><span style="color:red">*</span> Hours Code Description</label>
                            @Html.TextBoxFor(x => x.HoursCodeDescription, new { @class = "form-control", data_required = "Y" })
                            @Html.ValidationMessageFor(x => x.HoursCodeDescription)
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group ">
                            <label> ADP Field Mapping </label>
                            @Html.DropDownListFor(model => model.ADPFieldMappingId,
                                     new SelectList((System.Collections.IEnumerable)ViewData["adpFieldMappingsList"], "ADPFieldMappingId", "ADPFieldMappingCode"), new { @class = "form-control" })

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-group ">
                            <label> ADP Acc Number</label>
                            @Html.DropDownListFor(model => model.ADPAccNumberId,
                                     new SelectList((System.Collections.IEnumerable)ViewData["adpAccNumbersList"], "ADPAccNumberId", "ADPAccNumberDesc"), new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group ">
                            <label> Rate Override </label>
                            @Html.TextBoxFor(x => x.RateOverride, new { @class = "form-control", @type = "number" })
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group ">
                            <label> Rate Multiplier </label>
                            @Html.TextBoxFor(x => x.RateMultiplier, new { @class = "form-control", @type = "number" })
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Start Date</label>
                            @Html.TextBoxFor(model => model.StartDate, "{0:MM/dd/yyyy}", new { @class = "datepicker form-control", @Id = "txtStartDate" })
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>End Date</label>
                            @Html.TextBoxFor(model => model.EndDate, "{0:MM/dd/yyyy}", new { @class = "datepicker form-control", @Id = "txtEndDate" })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-2 p-t-30">
                        <div class="form-group ">
                            @Html.CheckBoxFor(x => x.ExcludeFromOT)
                            <label> Exclude From OT </label>
                        </div>
                    </div>
                    <div class="col-sm-2 p-t-30">
                        <div class="form-group ">

                            @Html.CheckBoxFor(x => x.SubtractFromRegular)
                            <label> Subtract From Regular </label>
                        </div>
                    </div>
                    <div class="col-sm-2 p-t-30">
                        <div class="form-group ">
                            @Html.CheckBoxFor(x => x.NonPayCode)
                            <label> Non Pay Code </label>
                        </div>
                    </div>
                    <div class="col-sm-2 p-t-30">
                        <div class="form-group ">
                            @Html.CheckBoxFor(x => x.IsHoursCodeActive)
                            <label> Active </label>
                        </div>
                    </div>
                    <div class="col-sm-2 p-t-30">
                        <div class="form-group ">
                            @Html.CheckBoxFor(x => x.IsRetro)
                            <label> Is Retro </label>
                        </div>
                    </div>
                </div>
                        }
                    </div>
    </div>    
</div>
<div class="p-15 text-right">
    <button type="button" class="btn btn-default waves-effect md-close m-r-15">Cancel</button>
    <button type="button" class="btn btn-primary" id="btnSubmit">Done</button>
</div>

<script>
    $(document).ready(function () {
        pageSetup();
        loading(false)
        $("#txtStartDate").on('change', function () {
            var appBaseUrl = $("#appBaseUrl").val();
            var startDate = $("#txtStartDate").val();
            var endDate = $("#txtEndDate").val();
            if (startDate != '' && endDate != '') {
                if (Date.parse(startDate) >= Date.parse(endDate)) {
                    $("#txtEndDate").val('');
                    toastr.error("End Date can't be less than start Date. ");
                    return false;
                }
            }
        });
        $("#txtEndDate").on('change', function () {
            var appBaseUrl = $("#appBaseUrl").val();
            var startDate = $("#txtStartDate").val();
            var endDate = $("#txtEndDate").val();
            if (startDate != '' && endDate != '') {
                if (Date.parse(startDate) >= Date.parse(endDate)) {
                    $("#txtEndDate").val('');
                    toastr.error("End Date can't be less than start Date. ");
                    return false;
                }
            }
        });
    });
    $("#btnSubmit").click(function (e) {        
        e.preventDefault();
        if (!ValidateForm("frmHoursCode")) {
            loading(false);
            return;
        }
        var postData = $("#frmHoursCode").serializeArray();
        var formURL = $("#ApplicationUrl").val() + "HoursCodes/HoursCodeSaveAjax";
        $.post(formURL, postData, function (data, status) {
            if (data.succeed == false) {
                toastr.error(data.Message);
            }
            else {
                var _oldhiddenDepartmentId = $("#hiddenHourId").val();
                resetGrid("gridHoursCode");
                //LoadMenu("HoursCodesMatrixPartial", "HoursCodes");
                $("#btnSubmit").parent().find(".md-close").click();
                if (_oldhiddenDepartmentId != "0") {
                    toastr.success(formService.messages.updated);
                }
                else {
                    toastr.success(formService.messages.saved);
                }
            }
        });
    });
</script>
